<p-toast></p-toast>

<div class="page-container" *ngIf="!isLoading && workout">

  <div class="hud-header">
    
    <div class="workout-meta-row">
      <div class="left-meta">
        <button type="button" class="home-btn" (click)="onExitSession()">
          <i class="pi pi-home"></i>
        </button>
        <span class="workout-title">{{ workout.name }}</span>
      </div>
      <span class="progress-text">EX {{ currentExerciseIndex + 1 }} / {{ workout.exercises.length }}</span>
    </div>

    <div class="pixel-progress-track">
      <div class="pixel-progress-fill" [style.width.%]="progressPercentage"></div>
    </div>

    <div class="exercise-banner" *ngIf="workout.exercises[currentExerciseIndex] as currentExercise">
      <h2 class="font-logo">{{ currentExercise.exerciseName }}</h2>
      
      <div class="target-badges">
        <div class="pixel-tag">
          <i class="pi pi-list"></i>
          <span>{{ currentExercise.sets }} Séries</span>
        </div>
        <div class="pixel-tag">
          <i class="pi pi-refresh"></i>
          <span>{{ currentExercise.repsPerSet }} Reps</span>
        </div>
      </div>
    </div>
  </div>
   <div class="current-exercise-container" *ngIf="workout.exercises[currentExerciseIndex]">
    <form [formGroup]="currentExerciseForm" class="sets-list">
       <div formArrayName="sets" class="sets-container">
            <div [formGroupName]="currentSetIndex" class="set-card">
              <div class="set-badge">
                <span>SÉRIE</span>
                <span class="number">#{{ currentSetIndex + 1 }}/{{ setsFormArray.length }}</span>
              </div>
    
              <div class="controls-wrapper">
                
                <div class="control-group">
                  <label class="pixel-label">KG</label>
                  <div class="stepper-box">
                    <button type="button" class="pixel-btn-step minus" (click)="adjustWeight(currentSetIndex, -2.5)"><i class="pi pi-minus"></i></button>
                    <p-inputNumber formControlName="weight" [min]="0" [maxFractionDigits]="1" [showButtons]="false" styleClass="pixel-input-wrapper" inputStyleClass="pixel-input"></p-inputNumber>
                    <button type="button" class="pixel-btn-step plus" (click)="adjustWeight(currentSetIndex, 2.5)"><i class="pi pi-plus"></i></button>
                  </div>
                </div>
    
                <div class="divider-vertical"></div>
    
                <div class="control-group">
                  <label class="pixel-label">REPS</label>
                  <div class="stepper-box">
                    <button type="button" class="pixel-btn-step minus" (click)="adjustReps(currentSetIndex, -1)"><i class="pi pi-minus"></i></button>
                    <p-inputNumber formControlName="reps" [min]="0" [showButtons]="false" styleClass="pixel-input-wrapper" inputStyleClass="pixel-input"></p-inputNumber>
                    <button type="button" class="pixel-btn-step plus" (click)="adjustReps(currentSetIndex, 1)"><i class="pi pi-plus"></i></button>
                  </div>
                </div>
    
              </div>
    
              <div class="action-col">
                <button type="button" class="pixel-btn-icon danger" (click)="removeSet(currentSetIndex)"><i class="pi pi-trash"></i></button>
              </div>
            </div>
          </div>
    
          <div class="add-set-container" *ngIf="isLastSet">
            <p-button label="Nova Série" icon="pi pi-plus" styleClass="p-button-outlined full-width-btn" (click)="addSet()"></p-button>
          </div>
          
          <div class="control-group" style="margin-top: 1.5rem;" *ngIf="isLastSet">
            <label class="pixel-label">NOTAS DO EXERCÍCIO</label>
            <textarea formControlName="notes" class="pixel-input" rows="3" style="width: 100%; padding: 0.5rem; resize: none;" placeholder="Adicione notas sobre o exercício..."></textarea>
          </div>
    </form>
  </div>

  <div class="navigation-controls">
    
    <p-button 
        label="Anterior" 
        icon="pi pi-arrow-left" 
        styleClass="p-button-outlined p-button-secondary" 
        [disabled]="currentExerciseIndex === 0 && currentSetIndex === 0"
        (click)="onPreviousSet()">
    </p-button>

    <div class="right-actions">
        <p-button *ngIf="!isLastSet" label="Próxima Série" icon="pi pi-arrow-right" iconPos="right" (click)="onNextSet()"></p-button>
        
        <p-button *ngIf="isLastSet && !isLastSetOfWorkout" label="Próximo Exercício" icon="pi pi-angle-double-right" iconPos="right" styleClass="p-button-info" (click)="onNextExercise()"></p-button>
        
        <p-button *ngIf="isLastSetOfWorkout" label="Finalizar" icon="pi pi-check" iconPos="right" styleClass="p-button-success" (click)="onCompleteWorkout()" [loading]="isSaving"></p-button>
  </div>
</div>

<!-- Modal Overlay -->
<div class="pixel-modal-overlay" *ngIf="showExitConfirmation">
  <div class="pixel-modal">
    <h3 class="font-logo text-warning">Atenção</h3>
    <p>Deseja sair do treino? Seu progresso atual será perdido.</p>
    <div class="modal-actions">
      <button class="pixel-btn-text" (click)="cancelExit()">Cancelar</button>
      <button class="pixel-btn-filled danger" (click)="confirmExit()">Sair</button>
    </div>
  </div>
</div>